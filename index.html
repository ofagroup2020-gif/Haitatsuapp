<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OFA Delivery</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<div class="bgGlow"></div>

<div class="container">

  <div class="topbar">
    <div class="brand">
      <div class="logoChip">OFA</div>
      <div>
        <div class="brandTitle">OFA DELIVERY</div>
        <small class="brandSub">ログインして開始</small>
      </div>
    </div>
    <span class="badge">PWA / Cloud DB</span>
  </div>

  <!-- エラー表示（ここに出る） -->
  <div id="err" class="errBox" style="display:none;"></div>

  <div class="card">
    <div class="cardTitle">
      <strong>ログイン</strong>
      <span class="badge">Email / Password</span>
    </div>

    <div class="twoCol">
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" placeholder="example@ofa.co.jp" />
      </div>
      <div class="field">
        <label>Password</label>
        <input id="pass" type="password" placeholder="******" />
      </div>
    </div>

    <div class="btnRow">
      <button class="btn primary" id="btnLogin" type="button">ログイン</button>
      <button class="btn neon" id="btnSignup" type="button">新規作成（管理者作成運用でもOK）</button>
    </div>

    <hr class="sep" />

    <div class="btnRow">
      <a class="btn green" href="driver.html">配達員アプリへ</a>
      <a class="btn danger" href="admin.html">管理画面へ</a>
    </div>

    <p class="note" style="margin-top:12px;">
      ※最初に <b>Firebase設定</b> を <code>app.js</code> に貼ってください。
    </p>
  </div>
</div>

<script type="module">
  const $ = (id) => document.getElementById(id);
  const showErr = (msg) => {
    const box = $("err");
    box.style.display = "block";
    box.textContent = msg;
  };

  // app.js 読み込み失敗を画面に出す（ここが超大事）
  let api;
  try {
    api = await import("./app.js");
  } catch (e) {
    showErr("app.jsの読み込みに失敗しました。\n\n" + (e?.message ?? String(e)) + "\n\n（app.jsがJSエラー/未コミット/キャッシュの可能性）");
    throw e;
  }

  const authLogin = api.authLogin ?? window.login;
  const authSignup = api.authSignup ?? window.register;

  if (!authLogin || !authSignup) {
    showErr("authLogin/authSignup が見つかりません。\napp.js がA案の全文になっているか確認してください。");
  }

  $("btnLogin").addEventListener("click", async () => {
    try {
      await authLogin($("email").value.trim(), $("pass").value);
      alert("ログインOK");
    } catch (e) {
      alert(e?.message ?? String(e));
    }
  });

  $("btnSignup").addEventListener("click", async () => {
    try {
      await authSignup($("email").value.trim(), $("pass").value);
      alert("作成OK（ログイン済）");
    } catch (e) {
      alert(e?.message ?? String(e));
    }
  });
</script>

</body>
</html>

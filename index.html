<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OFA 配達アプリ</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">

  <!-- iPhone対応: ZXing -->
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>
</head>
<body>
<header class="hdr">
  <div class="hdr__top">
    <div class="brand">
      <div class="logo">OFA</div>
      <div class="brand__txt">
        <div class="brand__title">配達アプリ</div>
        <div class="brand__sub">SCAN → リスト → 地図 → 完了/不在 → 日報</div>
      </div>
    </div>
    <div class="chips">
      <span class="chip" id="chipGps">GPS: 未取得</span>
      <span class="chip" id="chipScan">SCAN: 停止</span>
    </div>
  </div>

  <nav class="tabs">
    <button class="tab active" data-tab="scan">SCAN</button>
    <button class="tab" data-tab="list">リスト</button>
    <button class="tab" data-tab="report">日報</button>
    <a class="tab tab--link" href="map.html">地図</a>
  </nav>
</header>

<main class="wrap">

  <!-- SCAN -->
  <section class="card" id="tab-scan">
    <div class="row">
      <button class="btn btn--blue" id="btnGps">📍 GPS</button>
      <button class="btn btn--yellow" id="btnStart">📷 連続スキャン</button>
      <button class="btn btn--ghost" id="btnStop">⏹ 停止</button>
      <button class="btn btn--ghost" id="btnTorch">🔦 ライト</button>
    </div>

    <div class="row row--tight mt8">
      <div class="seg">
        <button class="seg__btn seg__btn--on" data-kind="宅配">宅配</button>
        <button class="seg__btn" data-kind="手紙">手紙</button>
        <button class="seg__btn" data-kind="ポスト投函">投函</button>
        <button class="seg__btn" data-kind="冷蔵・冷凍">冷</button>
        <button class="seg__btn" data-kind="代引">代</button>
        <button class="seg__btn" data-kind="大物">大</button>
        <button class="seg__btn" data-kind="壊れ物">壊</button>
      </div>
    </div>

    <div class="videoWrap" id="videoWrap" style="display:none">
      <video id="video" playsinline muted></video>
    </div>

    <div class="row mt10">
      <button class="btn btn--ghost" id="btnTemp">＋ 読めない（仮登録）</button>
      <button class="btn btn--ghost" id="btnManual">＋ 手動登録</button>
      <button class="btn btn--ghost" id="btnBulkOut">🚚 持出一括（未配達→持出）</button>
    </div>

    <div class="hint" id="scanHint">待機中：連続スキャンを押してください。</div>
  </section>

  <!-- LIST -->
  <section class="card" id="tab-list" style="display:none">
    <div class="kpis">
      <span class="chip chip--kpi">未配達 <b id="kTodo">0</b></span>
      <span class="chip chip--kpi">不在 <b id="kAbsent">0</b></span>
      <span class="chip chip--kpi">完了 <b id="kDone">0</b></span>
      <span class="chip chip--kpi">再配達 <b id="kRedeliver">0</b></span>
    </div>

    <div class="row mt8">
      <select id="filterStatus" class="sel">
        <option value="todo">未配達</option>
        <option value="absent">不在</option>
        <option value="done">完了</option>
        <option value="all">全て</option>
      </select>

      <select id="sortMode" class="sel">
        <option value="custom">指定順（手動）</option>
        <option value="created">登録順</option>
        <option value="nearest">近い順（GPS）</option>
        <option value="redelivery">再配達優先</option>
      </select>

      <button class="btn btn--ghost" id="btnRefreshGeo">📍 ピン化（住所→座標）</button>
    </div>

    <div class="hint mt8">
      ✅ スワイプ：右=完了 / 左=不在　｜　☝長押しドラッグで順番入替（指定順）
    </div>

    <div class="list" id="listBox"></div>
  </section>

  <!-- REPORT -->
  <section class="card" id="tab-report" style="display:none">
    <div class="row">
      <button class="btn btn--ghost" id="btnExportCsv">⬇ CSV出力</button>
      <button class="btn btn--ghost" id="btnPrint">🖨 印刷/PDF</button>
      <button class="btn btn--danger" id="btnClearDone">🧹 完了だけ削除</button>
    </div>

    <div class="report" id="reportBox"></div>
    <div class="hint mt8">※ 置き配写真は容量制限があるため、まずは“メモ中心”推奨（必要なら次でクラウド保存に拡張）。</div>
  </section>

</main>

<!-- 共通モーダル（編集 / 誤配防止スキャン / 置き配など） -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="modal__bg" id="modalBg"></div>
  <div class="modal__panel" role="dialog" aria-modal="true">
    <div class="modal__hd">
      <div class="modal__title" id="modalTitle">編集</div>
      <button class="btn btn--ghost" id="modalClose">✕</button>
    </div>
    <div class="modal__bd" id="modalBody"></div>
    <div class="modal__ft" id="modalFoot"></div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OFA Delivery｜管理</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="container">

  <div class="topbar">
    <div class="brand">
      <div style="width:38px;height:38px;border-radius:14px;background:linear-gradient(180deg,rgba(255,214,10,.95),rgba(255,45,85,.55));display:grid;place-items:center;font-weight:900;color:#111;">OFA</div>
      <div>
        <div style="font-size:14px;font-weight:900;">管理画面</div>
        <small>一覧確認</small>
      </div>
    </div>
    <span class="badge">Admin</span>
  </div>

  <div class="card">
    <div class="cardTitle">
      <strong>配達データ一覧</strong>
      <span class="badge">Firestore</span>
    </div>

    <div class="btnRow">
      <button class="btn yellow" id="btnReload">更新</button>
      <a class="btn danger" href="index.html">戻る</a>
    </div>

    <div id="list" class="note" style="margin-top:12px;">読み込み中...</div>
  </div>

</div>

<script type="module">
  import { loadDeliveries } from "./app.js";
  const $ = (id) => document.getElementById(id);

  async function render() {
    try {
      const rows = await loadDeliveries();
      const html = rows
        .slice()
        .reverse()
        .map((r) => {
          const img = r.imageUrl ? `<a href="${r.imageUrl}" target="_blank" rel="noreferrer">画像を見る</a>` : "なし";
          return `
            <div style="padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:14px;margin:10px 0;">
              <div style="font-weight:900;">${r.date ?? ""} / ${r.area ?? ""}</div>
              <div style="opacity:.9;margin-top:4px;">取引先：${r.client ?? ""} ｜ 個数：${r.qty ?? ""}</div>
              <div style="opacity:.8;margin-top:4px;">メモ：${r.memo ?? ""}</div>
              <div style="opacity:.8;margin-top:6px;">画像：${img}</div>
            </div>
          `;
        })
        .join("");
      $("list").innerHTML = html || `<div class="note">まだデータがありません</div>`;
    } catch (e) {
      $("list").innerHTML = `<div class="note">読み込みエラー：${e?.message ?? String(e)}</div>`;
    }
  }

  $("btnReload").onclick = render;
  render();
</script>
</body>
</html>
